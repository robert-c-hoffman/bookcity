# Shelfarr Docker Compose
#
# Quick start:
#   1. Copy this file to docker-compose.yml
#   2. Update the volume paths for your system
#   3. Run: docker-compose up -d
#
# That's it! A secret key is auto-generated on first run.

services:
  shelfarr:
    image: ghcr.io/pedro-revez-silva/shelfarr:latest
    container_name: shelfarr
    restart: unless-stopped
    ports:
      - "5056:${HTTP_PORT:-80}"
    volumes:
      # Database and app storage (required - contains auto-generated secret key)
      - ./data:/rails/storage
      # Audiobooks output folder (where Shelfarr places completed audiobooks)
      - /path/to/audiobooks:/audiobooks
      # Ebooks output folder (where Shelfarr places completed ebooks)
      - /path/to/ebooks:/ebooks
      # Download client completed folder (where downloads land before processing)
      - /path/to/downloads:/downloads
    environment:
      - SOLID_QUEUE_IN_PUMA=1
      # Optional: Set user/group ID to match the owner of your mounted volumes
      # Run: ls -n /path/to/your/data to find the UID/GID
      # - PUID=1000
      # - PGID=1000
      # Optional: Change internal port (default: 80)
      # - HTTP_PORT=8080
      # Optional: Set your own key instead of auto-generating
      # - RAILS_MASTER_KEY=your-64-char-hex-key
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${HTTP_PORT:-80}/up"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
